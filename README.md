# TryOn â€” AI ê¸°ë°˜ íŒ¨ì…˜ ì½”ë”” & ê°€ìƒ í”¼íŒ… Android ì•±

**TryOn**ì€ AIë¥¼ í™œìš©í•œ ìŠ¤ë§ˆíŠ¸ íŒ¨ì…˜ ì–´ì‹œìŠ¤í„´íŠ¸ ì•±ìœ¼ë¡œ, ì‚¬ìš©ìì˜ ì˜·ì¥ì„ ë””ì§€í„¸í™”í•˜ê³  ë‚ ì”¨ ê¸°ë°˜ ì½”ë”” ì¶”ì²œ, ê°€ìƒ í”¼íŒ…, ì´ë¯¸ì§€ ê²€ìƒ‰ ê¸°ë°˜ ì‡¼í•‘ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ“± ì£¼ìš” ê¸°ëŠ¥

### 1. **ë””ì§€í„¸ ì˜·ì¥ (Wardrobe)**
- ğŸ“¸ **ìë™ íƒœê¹…**: ì‚¬ì§„ ì´¬ì˜ ë˜ëŠ” ì›¹ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œ Google Vertex AI Geminiê°€ ìë™ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬(ìƒì˜/í•˜ì˜/ì•„ìš°í„°), ìƒ‰ìƒ, íŒ¨í„´, ì†Œì¬, ë³´ì˜¨ë„, ë°©ìˆ˜ì„± ë“±ì„ ë¶„ì„
- ğŸ” **í•„í„°ë§**: íƒ€ì…(Top/Bottom/Outer), ìƒ‰ìƒ, íƒœê·¸ë¡œ ì•„ì´í…œ ê²€ìƒ‰
- ğŸ›ï¸ **ìœ ì‚¬ ìƒí’ˆ ì°¾ê¸°**: ì˜·ì¥ ì•„ì´í…œì„ ê¸°ë°˜ìœ¼ë¡œ ë„¤ì´ë²„Â·êµ¬ê¸€ ì‡¼í•‘ì—ì„œ ìœ ì‚¬ ìƒí’ˆ ìë™ ê²€ìƒ‰

### 2. **ë‚ ì”¨ ê¸°ë°˜ ì½”ë”” ì¶”ì²œ (Home)**
- ğŸŒ¤ï¸ **ì‹¤ì‹œê°„ ë‚ ì”¨ ë¶„ì„**: Open-Meteo APIë¡œ í˜„ì¬ ê¸°ì˜¨, ê°•ìˆ˜ëŸ‰, í’ì† í™•ì¸
- ğŸ¯ **AI ì¶”ì²œ ì½”ë”” TOP 3**: ë‚ ì”¨ì— ë§ëŠ” ìµœì ì˜ ì¡°í•©ì„ ìë™ ì¶”ì²œ (ë³´ì˜¨ë„Â·ë°©ìˆ˜ì„±Â·íƒœê·¸ ë§¤ì¹­)
- âœ¨ **ê°€ìƒ í”¼íŒ…**: ì¶”ì²œ ì½”ë””ë¥¼ ë‚´ ì‚¬ì§„ì— ì˜¤ë²„ë ˆì´í•˜ì—¬ ì°©ìš© ë¯¸ë¦¬ë³´ê¸°

### 3. **ì´ë¯¸ì§€ ê¸°ë°˜ ì‡¼í•‘ (Shop)**
- ğŸ–¼ï¸ **ì´ë¯¸ì§€ ê²€ìƒ‰**: ì‚¬ì§„ ì—…ë¡œë“œ ì‹œ Geminiê°€ ìë™ ë¶„ì„í•˜ì—¬ ê´€ë ¨ ìƒí’ˆ ê²€ìƒ‰
- ğŸ›’ **ì–´ìš¸ë¦¬ëŠ” ì•„ì´í…œ ì¶”ì²œ**: ê²€ìƒ‰ëœ ìƒí’ˆê³¼ ì¡°í•© ê°€ëŠ¥í•œ ë³´ì™„ ì•„ì´í…œ ìë™ ì œì•ˆ (í´ë¦­ ì‹œ ì¬ê²€ìƒ‰)
- ğŸ”— **ë©€í‹°ëª° êµ¬ë§¤**: ì°œÂ·ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ ë° ëª°ë³„ ìˆœì°¨ ê²°ì œ (Chrome Custom Tabs)

### 4. **ê°€ìƒ í”¼íŒ… (Fitting)**
- ğŸ¨ **AI Try-On**: Google Vertex AI Gemini ì´ë¯¸ì§€ ëª¨ë¸ ê¸°ë°˜ ê°€ìƒ ì°©ìš© (NanoBanana ì—”ì§„)
- ğŸ’¾ **ê²°ê³¼ ì €ì¥ & ê³µìœ **: í”¼íŒ… ê²°ê³¼ë¥¼ ê°¤ëŸ¬ë¦¬ì— ì €ì¥í•˜ê±°ë‚˜ SNS ê³µìœ 

### 5. **ê°¤ëŸ¬ë¦¬ & í´ë”ë¸” ìµœì í™”**
- ğŸ“ **ì ì‘í˜• ê·¸ë¦¬ë“œ**: í™”ë©´ í¬ê¸°ì— ë”°ë¼ ì»¬ëŸ¼ ìˆ˜ ìë™ ì¡°ì • (í´ë”ë¸” ì§€ì›)
- ğŸ–¼ï¸ **í”¼íŒ… ê²°ê³¼ ê´€ë¦¬**: ì €ì¥ëœ ê°€ìƒ í”¼íŒ… ì´ë¯¸ì§€ í™•ì¸ ë° ê³µìœ 

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation                     â”‚
â”‚  (Jetpack Compose UI + ViewModel + StateFlow)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Domain                         â”‚
â”‚  (OutfitRecommender, MatchingItemsGenerator,       â”‚
â”‚   RecommendationService, CompositeTryOnEngine)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       Data                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Room DB     â”‚ Retrofit     â”‚ Gemini API       â”‚ â”‚
â”‚  â”‚ (ì˜·ì¥/ì¥ë°”êµ¬ë‹ˆ) â”‚ (ì‡¼í•‘ ê²€ìƒ‰)   â”‚ (íƒœê¹…/í”¼íŒ…/ê²€ìƒ‰) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê¸°ìˆ  ìŠ¤íƒ
- **ì–¸ì–´**: Kotlin 2.0.21
- **UI**: Jetpack Compose (BOM 2024.09.02), Material 3
- **ì•„í‚¤í…ì²˜**: MVVM + Repository Pattern
- **ë¹„ë™ê¸°**: Kotlin Coroutines + StateFlow
- **ë„¤ë¹„ê²Œì´ì…˜**: Jetpack Navigation Compose
- **ë¡œì»¬ DB**: Room (Wardrobe, Cart, FittingResult)
- **ë„¤íŠ¸ì›Œí‚¹**: Retrofit 2.11, Moshi, OkHttp
- **ì´ë¯¸ì§€**: Coil Compose 2.6
- **AI**:
  - Cloud: Google Vertex AI Gemini 2.5 Flash Lite (íƒœê¹…/ì¶”ì²œ)
  - Cloud: Google Vertex AI Gemini Image (ê°€ìƒ í”¼íŒ…)
  - On-device (Optional): llama.cpp + JNI (ì„ë² ë””ë“œ ëª¨ë¸ ì¶”ë¡ )
- **ì™¸ë¶€ API**: 
  - Open-Meteo (ë‚ ì”¨, API í‚¤ ë¶ˆí•„ìš”)
  - Naver Shopping API (Cloudflare Workers í”„ë¡ì‹œ)
  - Google Programmable Search (Cloudflare Workers í”„ë¡ì‹œ)
- **ë³´ì•ˆ**: Cloudflare Workers Proxyë¥¼ í†µí•œ API í‚¤ ë³´í˜¸ (ì•± ë‚´ í‚¤ ì €ì¥ ê¸ˆì§€)

---

## ğŸš€ ë¹Œë“œ ë° ì‹¤í–‰

### ìš”êµ¬ ì‚¬í•­
- **Android Studio**: Ladybug | 2024.2.1 ì´ìƒ
- **JDK**: 17
- **Minimum SDK**: 26 (Android 8.0)
- **Target SDK**: 34 (Android 14)
- **Compile SDK**: 35

### ì‹¤í–‰ ë°©ë²•

```bash
# Debug ë¹Œë“œ
./gradlew :app:assembleDebug

# APK ì„¤ì¹˜ ë° ì‹¤í–‰
./gradlew :app:installDebug

# í´ë¦° ë¹Œë“œ
./gradlew clean :app:assembleDebug
```

> **ì°¸ê³ **: Android Studioì—ì„œ `Run` ë²„íŠ¼(â–¶ï¸)ì„ í´ë¦­í•˜ì—¬ ë°”ë¡œ ë¹Œë“œ ë° ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
app/src/main/
â”œâ”€â”€ java/com/fitghost/app/
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ db/               # Room Database (Garment, CartItem, FittingResult)
â”‚   â”‚   â”œâ”€â”€ model/            # ë°ì´í„° ëª¨ë¸ (WeatherSnapshot, Product, etc.)
â”‚   â”‚   â”œâ”€â”€ repository/       # Repository (Shop, Weather, TryOn, Wardrobe)
â”‚   â”‚   â””â”€â”€ search/           # ê²€ìƒ‰ API (Naver, Google CSE)
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ OutfitRecommender.kt       # ë‚ ì”¨ ê¸°ë°˜ ì½”ë”” ì¶”ì²œ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ RecommendationService.kt   # ë³´ì™„ ìƒí’ˆ ì¶”ì²œ (ì„±ë³„ ê³ ë ¤)
â”‚   â”‚   â”œâ”€â”€ MatchingItemsGenerator.kt  # ì–´ìš¸ë¦¬ëŠ” ì•„ì´í…œ ìƒì„±
â”‚   â”‚   â””â”€â”€ tryon/                     # ê°€ìƒ í”¼íŒ… ì—”ì§„
â”‚   â”‚       â”œâ”€â”€ CompositeTryOnEngine.kt
â”‚   â”‚       â”œâ”€â”€ NanoBananaTryOnEngine.kt
â”‚   â”‚       â””â”€â”€ CloudTryOnEngine.kt
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ home/         # í™ˆ (ë‚ ì”¨ + ì¶”ì²œ ì½”ë””)
â”‚   â”‚   â”‚   â”œâ”€â”€ wardrobe/     # ì˜·ì¥ ê´€ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ shop/         # ì‡¼í•‘ (ê²€ìƒ‰/ì´ë¯¸ì§€ ê²€ìƒ‰)
â”‚   â”‚   â”‚   â”œâ”€â”€ cart/         # ì¥ë°”êµ¬ë‹ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ fitting/      # ê°€ìƒ í”¼íŒ…
â”‚   â”‚   â”‚   â””â”€â”€ gallery/      # í”¼íŒ… ê²°ê³¼ ê°¤ëŸ¬ë¦¬
â”‚   â”‚   â”œâ”€â”€ components/       # ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ theme/            # Material 3 í…Œë§ˆ
â”‚   â””â”€â”€ util/
â”‚       â”œâ”€â”€ GeminiApiHelper.kt        # Gemini API ë˜í¼
â”‚       â”œâ”€â”€ UserSettings.kt           # DataStore ê¸°ë°˜ ì„¤ì •
â”‚       â””â”€â”€ ColorExtractor.kt         # ì´ë¯¸ì§€ ìƒ‰ìƒ ì¶”ì¶œ
â”œâ”€â”€ cpp/
â”‚   â””â”€â”€ EmbeddedServerJni.cpp         # llama.cpp JNI ë¸Œë¦¿ì§€ (ì„ íƒ)
â””â”€â”€ res/
    â”œâ”€â”€ drawable/                     # ì•„ì´ì½˜ ë° ì´ë¯¸ì§€
    â”œâ”€â”€ values/                       # ë¬¸ìì—´, ìƒ‰ìƒ, í…Œë§ˆ
    â””â”€â”€ xml/                          # FileProvider, Backup ì„¤ì •
```

---

## ğŸ”§ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. **ìë™ íƒœê¹… (Auto-Tagging)**
- **íŒŒì¼**: `util/GeminiApiHelper.kt`
- **ê¸°ëŠ¥**: ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œ Gemini APIë¡œ JSON ì‘ë‹µ ë°›ì•„ ìë™ íŒŒì‹±
- **ìŠ¤í‚¤ë§ˆ ê²€ì¦**: Moshi ê¸°ë°˜ ì—„ê²©í•œ íƒ€ì… ì²´í¬ + ì¬ì‹œë„ ë¡œì§
- **ì‘ë‹µ ì‹œê°„**: 600~1500ms (Cloud-only)

### 2. **ë‚ ì”¨ ê¸°ë°˜ ì¶”ì²œ**
- **íŒŒì¼**: `domain/OutfitRecommender.kt`
- **ë¡œì§**:
  1. Open-Meteoì—ì„œ í˜„ì¬ ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸°
  2. ì˜·ì¥ ì•„ì´í…œ ì¤‘ ê¸°ì˜¨-ë³´ì˜¨ë„, ê°•ìˆ˜-ë°©ìˆ˜ì„±, í’ì†-ê²‰ì˜· ë§¤ì¹­
  3. íƒœê·¸ ê¸°ë°˜ í˜¸í™˜ì„± ì ìˆ˜ ê³„ì‚°
  4. TOP 3 ì¡°í•© ë°˜í™˜

### 3. **ì´ë¯¸ì§€ ê²€ìƒ‰ (Image Search)**
- **íŒŒì¼**: `ui/screens/shop/ShopScreen.kt`, `data/repository/ShopRepository.kt`
- **í”Œë¡œìš°**:
  1. ì‚¬ì§„ ì—…ë¡œë“œ â†’ Gemini APIë¡œ ìë™ ë¶„ì„
  2. ì¹´í…Œê³ ë¦¬, ìƒ‰ìƒ, íŒ¨í„´ ì¶”ì¶œ
  3. ë„¤ì´ë²„/êµ¬ê¸€ ê²€ìƒ‰ API í˜¸ì¶œ (Cloudflare Proxy)
  4. **ì–´ìš¸ë¦¬ëŠ” ì•„ì´í…œ** ìë™ ìƒì„± â†’ í´ë¦­ ì‹œ ì¬ê²€ìƒ‰

### 4. **ê°€ìƒ í”¼íŒ… (Try-On)**
- **íŒŒì¼**: `domain/tryon/CompositeTryOnEngine.kt`
- **ì—”ì§„ ìš°ì„ ìˆœìœ„**:
  1. **NanoBanana** (Google Vertex AI Gemini Image) â€” Primary
  2. **CloudTryOnEngine** (Fallback)
- **ì¸ì¦**: Cloudflare Workers Proxyì—ì„œ OAuth 2.0 Service Account í† í° ìë™ ìƒì„±

### 5. **ì„±ë³„ ì •ë³´ í†µí•©**
- **íŒŒì¼**: `domain/RecommendationService.kt`
- **ê¸°ëŠ¥**: ëª¨ë“  ê²€ìƒ‰/ì¶”ì²œ ì‹œ ì‚¬ìš©ì ì„±ë³„ ì •ë³´ë¥¼ íƒœê·¸ë¡œ ìë™ í¬í•¨ (ì˜ˆ: "ë‚¨ì„±ìš© ì²­ë°”ì§€")
- **ì„¤ì •**: `util/UserSettings.kt`ì—ì„œ DataStore ê¸°ë°˜ ì˜ì† ì €ì¥

---



## ğŸ“Š ì„±ëŠ¥ ëª©í‘œ (Cloud-only)

| ê¸°ëŠ¥ | ëª©í‘œ ì‘ë‹µ ì‹œê°„ | ì„±ê³µë¥  | ì¬ì‹œë„ íšŸìˆ˜ |
|------|---------------|--------|------------|
| ìë™ íƒœê¹… | 600~1500ms | â‰¥ 98% | â‰¤ 2íšŒ |
| ì½”ë”” ì¶”ì²œ | 400~1200ms | â‰¥ 98% | â‰¤ 2íšŒ |
| ê°€ìƒ í”¼íŒ… | 2~5ì´ˆ | â‰¥ 95% | â‰¤ 2íšŒ |

---

## ğŸ”’ ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ

- âœ… **API í‚¤ ë³´í˜¸**: ëª¨ë“  í‚¤ ê¸°ë°˜ APIëŠ” Cloudflare Workers í”„ë¡ì‹œë¥¼ í†µí•´ í˜¸ì¶œ (ì•± ë‚´ í‚¤ ì €ì¥ ê¸ˆì§€)
- âœ… **PII ë¯¸ìˆ˜ì§‘**: í•˜ë“œì›¨ì–´ ì‹ë³„ì, ê°œì¸ì •ë³´ ìˆ˜ì§‘í•˜ì§€ ì•ŠìŒ
- âœ… **ë¡œì»¬ ìš°ì„ **: ì˜·ì¥/ì¥ë°”êµ¬ë‹ˆëŠ” Room DBì—ë§Œ ì €ì¥ (ì„œë²„ ì „ì†¡ ì—†ìŒ)
- âœ… **OAuth 2.0**: Vertex AI í˜¸ì¶œ ì‹œ Service Account ê¸°ë°˜ í† í° ì¸ì¦ (Worker Secrets ë³´ê´€)

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [MASTERPRD_UNIFIED.md](./MASTERPRD_UNIFIED.md) - ì „ì²´ ê¸°ëŠ¥ ëª…ì„¸ ë° ìš”êµ¬ì‚¬í•­
- [NOWGUIDE.md](./NOWGUIDE.md) - í”„ë¡œì íŠ¸ ê°€ì´ë“œ ë° ì¶”ê°€ ì •ë³´
- [Jetpack Compose ê³µì‹ ë¬¸ì„œ](https://developer.android.com/jetpack/compose)
- [Google Vertex AI Gemini](https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini)
- [Room Persistence Library](https://developer.android.com/training/data-storage/room)

---

## ğŸ› ï¸ ë¬¸ì œ í•´ê²°

### Q1: ë¹Œë“œ ì‹¤íŒ¨ - "GEMINI_API_KEY not found"
**A**: `local.properties`ì— `GEMINI_API_KEY=your_key_here` ì¶”ê°€ í•„ìš”

### Q2: ë„¤ì´í‹°ë¸Œ ë¹Œë“œ ì‹¤íŒ¨ (CMake)
**A**: ì˜¨ë””ë°”ì´ìŠ¤ AIë¥¼ ë¹„í™œì„±í™”í•˜ë ¤ë©´ `-PenableEmbeddedLlama=false` í”Œë˜ê·¸ ì‚¬ìš© (ê¸°ë³¸ê°’: false)

### Q3: ê°€ìƒ í”¼íŒ… ì‹¤íŒ¨ (Try-On)
**A**: 
1. `PROXY_BASE_URL`ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
2. Cloudflare Workers Proxyê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
3. ë¡œê·¸ì—ì„œ OAuth 2.0 í† í° ì˜¤ë¥˜ ì²´í¬

### Q4: ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
**A**: 
1. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
2. Cloudflare Workers Proxy ìƒíƒœ í™•ì¸
3. Naver/Google API í• ë‹¹ëŸ‰ í™•ì¸

---

## ğŸ“ í”„ë¡œì íŠ¸ ì •ë³´

**ê°œë°œ í™˜ê²½**: Android Studio Ladybug | 2024.2.1  
**ê°œë°œ ì–¸ì–´**: Kotlin 2.0.21  
**ì£¼ìš” í”„ë ˆì„ì›Œí¬**: Jetpack Compose, Room, Retrofit  

---

**Built with â¤ï¸ using Kotlin & Jetpack Compose**
